# Тестирование и инструменты качества

Проект поставляется с готовой конфигурацией для PHPUnit, PHP_CodeSniffer и PHPStan.

## PHPUnit

- Запуск: `composer test`
- Конфигурация: `phpunit.xml`
- Тесты: каталог `test/`

Рекомендуемые сценарии:

- **Интеграционные тесты** — используйте `Kernel::handle($request, false)` для получения `ResponseInterface` без эмиссии.
- **Юнит-тесты** — проверяйте отдельные сервисы (`TemplateRenderer`, `MarkdownRenderer`, middleware).

## Code Style

`composer cs` запускает PHP_CodeSniffer (`phpcs`) с правилами из `.phpcs.xml`. Все новые изменения должны соответствовать стандарту.

Используйте `composer cs-fix`, чтобы автоматически исправить большинство ошибок форматирования (где применимо).

## Статический анализ

`composer stan` — запуск PHPStan с конфигурацией `phpstan.neon`. Уровень строгости высок, поэтому может потребоваться уточнять phpDoc и сигнатуры.

### Типичные замечания PHPStan

- **Отсутствует тип значений в массиве.** Добавьте описание вида `array<string, string>`.
- **Преобразование `mixed` в `string`.** Проверяйте тип через `is_string()` перед приведением.
- **Несовместимые типы для свойств.** Следите за тем, чтобы данные, которые вы присваиваете свойствам класса, соответствовали phpDoc.

## Рекомендуемый рабочий процесс

1. Напишите/измените код.
2. `composer cs`
3. `composer stan`
4. `composer test`

Используйте Git для изоляции изменений (коммиты, ветки). В CI можно запускать все три команды.

## Тестовая документация `/docs`

Поскольку документация открывается через HTTP-маршруты, вы можете писать тесты, проверяющие HTML-ответы (`DocsRoutesTest`). Это хороший пример интеграционных сценариев.

Дополнительно см.:

- [Ядро](kernel.md)
- [Маршрутизация](routing.md)
- [Middleware](middleware.md)
- [Ответы](responses.md)
